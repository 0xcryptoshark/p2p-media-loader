<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">

    <script src="p2p-media-loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        #video {
            width: 720px;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
    </style>

</head>
<body>

    <video id="video" controls></video>

    <script>

        if (Hls.isSupported()) {
            var p2pml = new P2PMediaLoader();

            var video = document.getElementById('video');
            var hls = new Hls({ loader: p2pml.getHlsJsLoader()/*debug: true*/ });
            hls.loadSource('https://wowza.peer5.com/live/smil:ski.smil/playlist.m3u8'); // live, 20 chunks ~5sec each
            //hls.loadSource('http://wms.shared.streamshow.it/carinatv/carinatv/playlist.m3u8'); // live, 3 chunks ~10 sec each
            //hls.loadSource('https://video-dev.github.io/streams/x36xhzz/x36xhzz.m3u8'); // VOD, 64 chunks
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                video.play();
                video.volume = 0.01;
            });
            hls.on(Hls.Events.FRAG_CHANGED, function (event, data) {
                var url = data && data.frag ? data.frag.url : undefined;
                p2pml.setCurrentFragment(url);
            });
        }

    </script>

</body>
</html>
